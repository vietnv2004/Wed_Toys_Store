@model Wed_Toys_Store.Models.HomeViewModel
@{
    ViewData["Title"] = "Home Page";
}

<style>
    /* Custom carousel controls positioning - Bootstrap không có utility tương tự */
    #bannerCarousel {
        position: relative;
        padding: 0 60px;
    }

    #bannerCarousel .carousel-control-prev,
    #bannerCarousel .carousel-control-next {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 50px;
        height: 50px;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        z-index: 10;
    }

    #bannerCarousel .carousel-control-prev {
        left: 10px;
    }

    #bannerCarousel .carousel-control-next {
        right: 10px;
    }

    #bannerCarousel .carousel-control-prev:hover,
    #bannerCarousel .carousel-control-next:hover {
        background-color: rgba(0, 0, 0, 0.7);
    }

    #bannerCarousel .carousel-inner {
        border-radius: 8px;
        overflow: hidden;
        height: 500px;
    }

    #bannerCarousel .carousel-item {
        height: 500px;
    }

    #bannerCarousel .carousel-item img {
        width: 100%;
        height: 500px;
        object-fit: cover;
        object-position: center;
    }

    /* Card hover effects - chỉ giữ animation */
    .category-card:hover,
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
    }
</style>

<!-- BANNER CAROUSEL -->
@if (Model.Banners != null && Model.Banners.Any())
{
    <div id="bannerCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
        <div class="carousel-indicators">
            @for (int i = 0; i < Model.Banners.Count(); i++)
            {
                <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="@i" 
                        class="@(i == 0 ? "active" : "")" aria-current="@(i == 0 ? "true" : "false")" 
                        aria-label="Slide @(i + 1)"></button>
            }
        </div>
        
        <div class="carousel-inner">
            @foreach (var (banner, index) in Model.Banners.Select((b, i) => (b, i)))
            {
                <div class="carousel-item @(index == 0 ? "active" : "")">
                    @if (!string.IsNullOrEmpty(banner.LinkUrl))
                    {
                        <a href="@banner.LinkUrl" class="d-block h-100">
                            <img src="@banner.ImageUrl" class="d-block w-100 h-100" alt="@banner.Title">
                        </a>
                    }
                    else
                    {
                        <img src="@banner.ImageUrl" class="d-block w-100 h-100" alt="@banner.Title">
                    }
                </div>
            }
        </div>
        
        <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
}

<div class="container">
    <!-- HOT CATEGORIES SECTION -->
    @if (Model.HotCategories != null && Model.HotCategories.Any())
    {
        <div class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold mb-0">Hot Categories</h2>
                <a asp-controller="Products" asp-action="Index" class="btn btn-outline-primary">View All</a>
            </div>
            <div class="row g-3">
                @foreach (var category in Model.HotCategories)
                {
                    // Map category name to appropriate icon
                    string iconClass = "bi-grid-3x3-gap"; // Default icon
                    string categoryNameLower = category.Name?.ToLower() ?? "";
                    
                    if (categoryNameLower.Contains("active") || categoryNameLower.Contains("sport") || categoryNameLower.Contains("outdoor"))
                    {
                        iconClass = "bi-lightning-charge";
                    }
                    else if (categoryNameLower.Contains("board") || categoryNameLower.Contains("game") || categoryNameLower.Contains("card"))
                    {
                        iconClass = "bi-dice-6";
                    }
                    else if (categoryNameLower.Contains("building") || categoryNameLower.Contains("block") || categoryNameLower.Contains("puzzle") || categoryNameLower.Contains("lego"))
                    {
                        iconClass = "bi-puzzle";
                    }
                    else if (categoryNameLower.Contains("car") || categoryNameLower.Contains("vehicle") || categoryNameLower.Contains("airplane") || categoryNameLower.Contains("plane") || categoryNameLower.Contains("truck"))
                    {
                        iconClass = "bi-airplane";
                    }
                    else if (categoryNameLower.Contains("creative") || categoryNameLower.Contains("art") || categoryNameLower.Contains("draw") || categoryNameLower.Contains("paint"))
                    {
                        iconClass = "bi-palette";
                    }
                    else if (categoryNameLower.Contains("dinosaur") || categoryNameLower.Contains("animal") || categoryNameLower.Contains("pet"))
                    {
                        iconClass = "bi-heart";
                    }
                    else if (categoryNameLower.Contains("doll") || categoryNameLower.Contains("figure") || categoryNameLower.Contains("action"))
                    {
                        iconClass = "bi-person";
                    }
                    else if (categoryNameLower.Contains("electronic") || categoryNameLower.Contains("robot") || categoryNameLower.Contains("tech"))
                    {
                        iconClass = "bi-cpu";
                    }
                    else if (categoryNameLower.Contains("educational") || categoryNameLower.Contains("learning") || categoryNameLower.Contains("book"))
                    {
                        iconClass = "bi-book";
                    }
                    else if (categoryNameLower.Contains("music") || categoryNameLower.Contains("instrument"))
                    {
                        iconClass = "bi-music-note-beamed";
                    }
                    <div class="col-md-2 col-sm-4 col-6">
                        <a asp-controller="Products" asp-action="Index" asp-route-categoryId="@category.Id" class="text-decoration-none">
                            <div class="card h-100 text-center p-3 category-card border border-secondary border-opacity-25">
                                <div class="d-flex justify-content-center align-items-center mb-2">
                                    <i class="bi @iconClass text-primary" style="font-size: 2.5rem;"></i>
                                </div>
                                <h6 class="card-title mb-0 fw-bold text-primary">@category.Name</h6>
                            </div>
                        </a>
                    </div>
                }
            </div>
        </div>
    }

    <!-- NEW ARRIVALS SECTION -->
    @if (Model.NewArrivals != null && Model.NewArrivals.Any())
    {
        <div class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold mb-0">New Arrivals - Kids Love</h2>
                <a asp-controller="Products" asp-action="Index" asp-route-sortBy="newest" class="btn btn-outline-primary">View All</a>
            </div>
            <div class="row g-4">
                @foreach (var product in Model.NewArrivals)
                {
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="card h-100 position-relative product-card border border-secondary border-opacity-25">
                            @if (product.IsNew)
                            {
                                <span class="badge bg-warning position-absolute top-0 end-0 m-2">New</span>
                            }
                            <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" class="text-decoration-none">
                                @if (!string.IsNullOrEmpty(product.ImageUrl))
                                {
                                    <img src="@product.ImageUrl" class="card-img-top" alt="@product.Name" style="height: 250px; object-fit: cover;">
                                }
                                else
                                {
                                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 250px;">
                                        <i class="bi bi-image" style="font-size: 3rem; color: #ccc;"></i>
                                    </div>
                                }
                            </a>
                            <div class="card-body d-flex flex-column">
                                <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" class="text-decoration-none text-dark">
                                    <h6 class="card-title fw-bold">@product.Name</h6>
                                </a>
                                <p class="card-text text-muted small">@(product.Description?.Length > 60 ? product.Description.Substring(0, 60) + "..." : product.Description)</p>
                                <div class="mt-auto">
                                    <p class="card-text mb-2">
                                        <strong class="text-danger fs-5">@product.Price.ToString("N0")₫</strong>
                                    </p>
                                    <div class="d-flex gap-2">
                                        <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" class="btn btn-outline-primary flex-fill">
                                            <i class="bi bi-eye me-1"></i> View
                                        </a>
                                        <button class="btn btn-primary" onclick="addToCart(@product.Id)">
                                            <i class="bi bi-cart-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- BEST SELLERS SECTION -->
    @if (Model.BestSellers != null && Model.BestSellers.Any())
    {
        <div class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold mb-0">Best Sellers</h2>
                <a asp-controller="Products" asp-action="Index" class="btn btn-outline-primary">View All</a>
            </div>
            <div class="row g-4">
                @foreach (var product in Model.BestSellers)
                {
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="card h-100 position-relative product-card border border-secondary border-opacity-25">
                            <span class="badge bg-danger position-absolute top-0 start-0 m-2">Hot</span>
                            <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" class="text-decoration-none">
                                @if (!string.IsNullOrEmpty(product.ImageUrl))
                                {
                                    <img src="@product.ImageUrl" class="card-img-top" alt="@product.Name" style="height: 250px; object-fit: cover;">
                                }
                                else
                                {
                                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 250px;">
                                        <i class="bi bi-image" style="font-size: 3rem; color: #ccc;"></i>
                                    </div>
                                }
                            </a>
                            <div class="card-body d-flex flex-column">
                                <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" class="text-decoration-none text-dark">
                                    <h6 class="card-title fw-bold">@product.Name</h6>
                                </a>
                                <p class="card-text text-muted small">@(product.Description?.Length > 60 ? product.Description.Substring(0, 60) + "..." : product.Description)</p>
                                <div class="mt-auto">
                                    <p class="card-text mb-2">
                                        <strong class="text-danger fs-5">@product.Price.ToString("N0")₫</strong>
                                    </p>
                                    <div class="d-flex gap-2">
                                        <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" class="btn btn-outline-primary flex-fill">
                                            <i class="bi bi-eye me-1"></i> View
                                        </a>
                                        <button class="btn btn-primary" onclick="addToCart(@product.Id)">
                                            <i class="bi bi-cart-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }

    <!-- FEATURED PRODUCTS SECTION -->
    @if (Model.FeaturedProducts != null && Model.FeaturedProducts.Any())
    {
        <div class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold mb-0">Featured Products</h2>
                <a asp-controller="Products" asp-action="Index" class="btn btn-outline-primary">View All</a>
            </div>
            <div class="row g-4">
                @foreach (var product in Model.FeaturedProducts)
                {
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="card h-100 position-relative product-card border border-secondary border-opacity-25">
                            @if (product.IsNew)
                            {
                                <span class="badge bg-warning position-absolute top-0 end-0 m-2">New</span>
                            }
                            <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" class="text-decoration-none">
                                @if (!string.IsNullOrEmpty(product.ImageUrl))
                                {
                                    <img src="@product.ImageUrl" class="card-img-top" alt="@product.Name" style="height: 250px; object-fit: cover;">
                                }
                                else
                                {
                                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 250px;">
                                        <i class="bi bi-image" style="font-size: 3rem; color: #ccc;"></i>
                                    </div>
                                }
                            </a>
                            <div class="card-body d-flex flex-column">
                                <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" class="text-decoration-none text-dark">
                                    <h6 class="card-title fw-bold">@product.Name</h6>
                                </a>
                                <p class="card-text text-muted small">@(product.Description?.Length > 60 ? product.Description.Substring(0, 60) + "..." : product.Description)</p>
                                <div class="mt-auto">
                                    <p class="card-text mb-2">
                                        <strong class="text-danger fs-5">@product.Price.ToString("N0")₫</strong>
                                    </p>
                                    <div class="d-flex gap-2">
                                        <a asp-controller="Products" asp-action="Details" asp-route-id="@product.Id" class="btn btn-outline-primary flex-fill">
                                            <i class="bi bi-eye me-1"></i> View
                                        </a>
                                        <button class="btn btn-primary" onclick="addToCart(@product.Id)">
                                            <i class="bi bi-cart-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>

<script>
    function addToCart(productId) {
        const token = document.querySelector('input[name="__RequestVerificationToken"]')?.value || '';
        
        fetch('/Cart/AddToCart', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: `productId=${productId}&quantity=1&__RequestVerificationToken=${encodeURIComponent(token)}`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update cart badge
                const cartBadge = document.querySelector('.cart-badge-count');
                if (cartBadge) {
                    cartBadge.textContent = data.cartCount || 0;
                    cartBadge.style.display = (data.cartCount > 0) ? 'flex' : 'none';
                }
            } else {
                alert('Error: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while adding to cart.');
        });
    }
</script>

